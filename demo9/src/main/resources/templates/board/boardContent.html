<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basicLayout}">
<script layout:fragment="script" th:inline="javascript">
  'use strict';
  var token = $("meta[name='_csrf']").attr("content");
  var header = $("meta[name='_csrf_header']").attr("content");


  function replyCheck() {
    let content = $("#content").val().trim();
    if(content == '') {
      alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return false;
    }

    $.ajax({
      url : "/board/boardReplyInput",
      type: "post",
      data: {
        "parentId": [[${board.id}]],
        "content" : content
      },
      beforeSend : (xhr) => xhr.setRequestHeader(header, token),
      success : (res) => {
        if(res == 1) {
          alert("ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
          location.reload();
        }
        else alert("ëŒ“ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      },
      error : () => alert("ì „ì†¡ì˜¤ë¥˜")
    });
  }

  function replyDeleteCheck(id) {
    let ans = confirm("ì •ë§ë¡œ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    if(ans){
      $.ajax({
        url : "/board/boardReplyDelete",
        type: "post",
        data: {"id" : id},
        beforeSend : (xhr) => xhr.setRequestHeader(header, token),
        success : (res) => {
          if(res == 1) {
            alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.reload();
          }
          else alert("ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        },
        error : () => alert("ì „ì†¡ì˜¤ë¥˜")
      });
    }
  }

  function replyUpdateCheck(id) {
    $("#replyUpdateForm"+id).show();
  }
  function replyUpdateViewClose(id) {
    $("#replyUpdateForm"+id).hide();
  }
  function replyUpdateCheckOk(id) {
    let content = $("#content"+id).val().trim();
    if(content == '') {
      alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return false;
    }

    $.ajax({
      url : "/board/boardReplyUpdate",
      type: "post",
      data: {
        "id" : id,
        "content" : content
      },
      beforeSend : (xhr) => xhr.setRequestHeader(header, token),
      success : (res) => {
        if(res == 1) {
            alert("ëŒ“ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.reload();
          }
        else alert("ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      },
      error : () => alert("ì „ì†¡ì˜¤ë¥˜")
    });
  }

  function goodCheck1() {
    $.ajax({
      url : "/board/boardGood",
      type: "post",
      data: {"id" : [[${board.id}]]},
      beforeSend : (xhr) => xhr.setRequestHeader(header, token),
      success : (res) => location.reload(),
      error : () => alert("ì „ì†¡ì˜¤ë¥˜")
    });
  }
  function goodCheck2(flag) {
    $.ajax({
      url : "/board/boardGood",
      type: "post",
      data: {
        "id" : [[${board.id}]],
        "flag" : flag
      },
      beforeSend : (xhr) => xhr.setRequestHeader(header, token),
      success : (res) => location.reload(),
      error : () => alert("ì „ì†¡ì˜¤ë¥˜")
    });
  }

  function delCheck() {
    let ans = confirm("ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    if(ans) {
      $.ajax({
        url : "/board/boardDelete",
        type: "post",
        data: {"id" : [[${board.id}]]},
        beforeSend : (xhr) => xhr.setRequestHeader(header, token),
        success : (res) => {
          if(res == 1) {
            alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.href = "/board/boardList";
          }
          else if(res == 2) alert("ê²Œì‹œê¸€ì— ëŒ“ê¸€ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì‚­ì œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
          else alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        },
        error : () => alert("ì „ì†¡ì˜¤ë¥˜")
      });
    };
  }
</script>
<div layout:fragment="content">
  <h2 class="text-center mb-4">ê¸€ ë‚´ìš© ë³´ê¸°</h2>
  <th:block th:if="${board.complaint == 'HI'}">
    <hr class="border border-dark">
    <h3 class="text-center text-danger">í•´ë‹¹ ê²Œì‹œê¸€ì€ ì‹ ê³ ëœ ê¸€ì…ë‹ˆë‹¤.</h3>
    <hr class="border border-dark">
    <div class="text-center">
      <input type="button" value="ëŒì•„ê°€ê¸°" onclick="location.href='boardList?pag=${pageDTO.pag}&pageSize=${pageDTO.pageSize}
        &search=${pageDTO.search}&searchStr=${pageDTO.searchStr}'" class="btn btn-info"/>
    </div>
  </th:block>
  <th:block th:if="${board.complaint != 'HI'}">
    <table class="table table-bordered text-center border-secondary-subtle">
      <tr>
        <th class="table-secondary">ê¸€ì“´ì´</th>
        <td>[[${board.name}]]</td>
        <th class="table-secondary">ê¸€ì“´ë‚ ì§œ</th>
        <td>[[${#strings.substring(board.wDate,0,19)}]]</td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ì¡°íšŒìˆ˜</th>
        <td>[[${board.readNum}]]</td>
        <th class="table-secondary">ì ‘ì†IP</th>
        <td>[[${board.hostIP}]]</td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ì œëª©</th>
        <td colspan="3" class="text-start">[[${board.title}]]
          (<a th:href="|javascript:goodCheck1()|" title="ì¢‹ì•„ìš”">â¤ï¸</a>([[${board.good}]]))
          (<a th:href="|javascript:goodCheck2('plus')|" title="ì¢‹ì•„ìš”">ğŸ‘</a>
          <a th:href="|javascript:goodCheck2('minus')|" title="ì‹«ì–´ìš”">ğŸ‘</a>([[${board.good}]]))
        </td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ë‚´ìš©</th>
        <td colspan="3" style="height:250px" class="text-start" th:utext="${#strings.replace(board.content, newLine, '<br/>')}"></td>
      </tr>
    </table>
    <!-- ëŒ“ê¸€ì²˜ë¦¬(ë¦¬ìŠ¤íŠ¸/ì…ë ¥) -->
    <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
    <table class="table table-hover text-center">
      <tr class="table-secondary">
        <th>ì‘ì„±ì</th>
        <th>ëŒ“ê¸€ë‚´ìš©</th>
        <th>ëŒ“ê¸€ì¼ì</th>
        <th>ì ‘ì†IP</th>
      </tr>
      <th:block th:each="replyDTO, st : ${replyList}">
        <tr>
          <td>[[${replyDTO.name}]]
            <th:block th:if="${session.sName == replyDTO.name || session.sStrLevel == 'ê´€ë¦¬ì'}">
              (<a th:href="|javascript:replyUpdateCheck(${replyDTO.id})|" title="ëŒ“ê¸€ìˆ˜ì •">âˆš</a>)
              (<a th:href="|javascript:replyDeleteCheck(${replyDTO.id})|" title="ëŒ“ê¸€ì‚­ì œ">x</a>)
            </th:block>
          </td>
          <!--<td class="text-start" th:utext="${replyDTO.content}"></td>-->
          <!--<td class="text-start" th:utext="${#strings.replace(replyDTO.content, newLine, '<br/>')}"></td>-->
          <!--<td class="text-start" th:utext="${#strings.replace(replyDTO.content, '\n', '<br/>')}"></td>-->
          <!--<td class="text-start" th:utext="${#strings.replace(replyDTO.content, '\\r\\n', '<br/>')}"></td>-->
          <!--<td class="text-start" th:utext="${#strings.replace(replyDTO.content, '\n\r', '<br/>')}"></td>-->
          <!--<td class="text-start" th:utext="${#strings.replace(replyDTO.content, '0D0A', '<br/>')}"></td>-->
          <td th:text="${replyDTO.content}" style="white-space: pre-line;" class="text-start"></td>
          <td>[[${#strings.substring(replyDTO.wDate, 0, 10)}]]</td>
          <td>[[${replyDTO.hostIP}]]</td>
        </tr>
        <!-- ì•„ë˜ë¡œ ëŒ“ê¸€ ìˆ˜ì • í¼ ë³´ê¸° -->
        <tr th:id="replyUpdateForm+${replyDTO.id}" style="display:none">
          <td colspan="4">
            <table class="table text-center">
              <tr>
                <td class="text-start" style="width:85%">
                  ëŒ“ê¸€ìˆ˜ì • :
                  <textarea rows="4" th:id="content+${replyDTO.id}" class="form-control">[[${replyDTO.content}]]</textarea>
                </td>
                <td style="width:15%"><br/>
                  <p>ì‘ì„±ì : [[${session.sName}]]</p>
                  <p>
                    <a th:href="|javascript:replyUpdateCheckOk(${replyDTO.id})|" class="badge bg-primary">ëŒ“ê¸€ìˆ˜ì •</a>
                    <a th:href="|javascript:replyUpdateViewClose(${replyDTO.id})|" class="badge bg-warning">ì°½ë‹«ê¸°</a>
                  </p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </th:block>
    </table>
    <hr/>
    <!-- ëŒ“ê¸€ ì…ë ¥ì°½ -->
    <table class="table text-center">
      <tr>
        <td class="text-start" style="width:85%">
          ëŒ“ê¸€ë‚´ìš© :
          <textarea rows="4" id="content" class="form-control"></textarea>
        </td>
        <td style="width:15%"><br/>
          <p>ì‘ì„±ì : [[${session.sName}]]</p>
          <p><input type="button" value="ëŒ“ê¸€ë‹¬ê¸°" onclick="replyCheck()" class="btn btn-info btn-sm"/></p>
        </td>
      </tr>
    </table>
    <div class="row">
      <div class="col">
        <input type="button" value="ëŒì•„ê°€ê¸°" th:onclick="|location.href='@{boardList(pag=${pageDTO.pag},pageSize=${pageDTO.pageSize}
          ,search=${pageDTO?.search},searchStr=${pageDTO?.searchStr})}'|" class="btn btn-info"/>
      </div>
      <div class="col">
        <th:block th:if="${session.sName != board.name && board.complaint == 'NO'}">
          <a href="#" data-bs-toggle="modal" data-bs-target="#myModal" class="btn btn-danger">ì‹ ê³ í•˜ê¸°</a>
        </th:block>
        <th:block th:if="${board.complaint == 'OK'}"><font color="red"><b>í˜„ì¬ ê²Œì‹œê¸€ì€ ì‹ ê³ ëœ ê¸€ì…ë‹ˆë‹¤.</b></font></th:block>
      </div>
      <!--<th:block th:if="${session.sName == board.name || session.sStrLevel == 'ê´€ë¦¬ì'}">-->
      <th:block th:if="${pageDTO.isOwner}">
        <div class="col">
          <th:block th:if="${session.sName == board.name}">
            <input type="button" value="ìˆ˜ì •" th:onclick="|location.href='@{boardUpdate(id=${board.id},pag=${pageDTO.pag}
              ,pageSize=${pageDTO.pageSize},search=${pageDTO?.search},searchStr=${pageDTO?.searchStr})}'|" class="btn btn-warning"/>
          </th:block>
          <input type="button" value="ì‚­ì œ" onclick="delCheck()" class="btn btn-danger"/>
        </div>
      </th:block>
      <p></p>
      <!--ë‹¤ìŒê¸€/ì´ì „ê¸€ ì‹œì‘-->
      <div class="row text-start">
        <div class="col">
          <th:block th:if="${nextDTO != null}">
            <a th:href="@{boardContent(id=${nextDTO.id},pag=${pageDTO.pag},pageSize=${pageDTO.pageSize}
              ,search=${pageDTO?.search},searchStr=${pageDTO?.searchStr})}">ë‹¤ìŒê¸€ : [[${nextDTO.title}]]</a><br/>
          </th:block>
          <th:block th:if="${preDTO != null}">
            <a th:href="@{boardContent(id=${preDTO.id},pag=${pageDTO.pag},pageSize=${pageDTO.pageSize}
              ,search=${pageDTO?.search},searchStr=${pageDTO?.searchStr})}">ì´ì „ê¸€ : [[${preDTO.title}]]</a><br/>
          </th:block>
        </div>
      </div>
      <hr/>
    </div>
    <!--ë‹¤ìŒê¸€/ì´ì „ê¸€ ë-->
  </th:block>
</div>
</html>