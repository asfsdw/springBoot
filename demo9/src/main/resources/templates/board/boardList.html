<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basicLayout}">
  <script layout:fragment="script" th:inline="javascript">
    'use strict';

    function pageSizeCheck() {
      let pag = [[${pageDTO.pag}]];
      let pageSize = $("#pageSize").val();
      let search = $("#search").val();
      let searchStr = $("#searchStr").val();

      location.href = "/board/boardList?pag="+pag+"&pageSize="+pageSize+"&search="+search+"&searchStr="+searchStr;
    }
  </script>
  <div layout:fragment="content">
    <h2>게시판 리스트</h2>
    <div class="row mt-2 mb-1">
      <div class="col text-start">
        <a th:href="@{/board/boardInput}" class="btn btn-success btn-sm">글쓰기</a>
      </div>
      <div class="col text-end">
        <select id="pageSize" name="pageSize" onchange="pageSizeCheck()">
          <option th:selected="${pageDTO.pageSize==5}">5</option>
          <option th:selected="${pageDTO.pageSize==10}">10</option>
          <option th:selected="${pageDTO.pageSize==15}">15</option>
          <option th:selected="${pageDTO.pageSize==20}">20</option>
          <option th:selected="${pageDTO.pageSize==25}">25</option>
          <option th:selected="${pageDTO.pageSize==50}">50</option>
        </select>
      </div>
    </div>
    <table class="table table-hover">
      <tr class="table-secondary">
        <th>번호</th>
        <th>글제목</th>
        <th>글쓴이</th>
        <th>글쓴날짜</th>
        <th>조회수(좋아요)</th>
      </tr>
      <th:block th:each="board, st : ${boardList}">
        <tr>
          <td th:text="${pageDTO.curScrStartNo - st.index}"></td>
          <td>
            <a th:href="@{boardContent(id=${board.id},pag=${pageDTO.pag},pageSize=${pageDTO.pageSize},search=${pageDTO.search},searchStr=${pageDTO.searchStr})}">
              [[${board.title}]]
            </a>
            <th:block th:if="${board.hourDiff <= 24}" th:utext="@{<img src='/images/new.gif' />}"></th:block>
          </td>
          <td>[[${board.name}]]</td>
          <td th:text="${#strings.substring(#strings.replace(board.wDate,'T',' '),0,19)}"></td>
          <td>[[${board.readNum}]]([[${board.good}]])</td>
        </tr>
      </th:block>
    </table>
    <!--블록페이지 시작-->
    <div class="text-center">
      <ul class="pagination justify-content-center">
        <th:block th:if="${pageDTO.pag > 0}"><li class="page-item"><a class="page-link text-secondary" th:href="@{boardList(pag=0, pageSize=${pageDTO.pageSize}, search=${pageDTO?.search}, searchStr=${pageDTO?.searchStr})}">첫페이지</a></li></th:block>
        <th:block th:if="${pageDTO.curBlock > 0}"><li class="page-item"><a class="page-link text-secondary" th:href="@{boardList(pag=${(pageDTO.curBlock-1)*pageDTO.blockSize}, pageSize=${pageDTO.pageSize}, search=${pageDTO?.search}, searchStr=${pageDTO?.searchStr})}">이전블록</a></li></th:block>
        <th:block th:each="i: ${#numbers.sequence((pageDTO.curBlock*pageDTO.blockSize),(pageDTO.curBlock*pageDTO.blockSize)+pageDTO.blockSize-1)}">
          <th:block th:if="${i < pageDTO.totPage && i == pageDTO.pag}"><li class="page-item active"><a th:text="${i+1}" class="page-link bg-secondary border-secondary"></a></li></th:block>
          <th:block th:if="${i < pageDTO.totPage && i != pageDTO.pag}"><li class="page-item"><a th:href="@{boardList(pag=${i}, pageSize=${pageDTO.pageSize}, search=${pageDTO?.search}, searchStr=${pageDTO?.searchStr})}" th:text="${i+1}" class="page-link text-secondary"></a></li></th:block>
        </th:block>
        <th:block th:if="${pageDTO.curBlock < pageDTO.lastBlock}"><li class="page-item"><a class="page-link text-secondary" th:href="@{boardList(pag=${(pageDTO.curBlock+1)*pageDTO.blockSize}, pageSize=${pageDTO.pageSize}, search=${pageDTO?.search}, searchStr=${pageDTO?.searchStr})}">다음블록</a></li></th:block>
        <th:block th:if="${pageDTO.pag < pageDTO.totPage-1}"><li class="page-item"><a class="page-link text-secondary" th:href="@{boardList(pag=${pageDTO.totPage-1}, pageSize=${pageDTO.pageSize}, search=${pageDTO?.search}, searchStr=${pageDTO?.searchStr})}">마지막페이지</a></li></th:block>
      </ul>
    </div>
    <!--블록페이지 끝-->
    <!-- 검색기 시작 -->
    <form name="searchForm" class="d-flex justify-content-center">
      <div class="input-group" style="width:500px">
        <b class="input-group-text">검색</b>
        <select id="search" name="search" class="form-select" style="width:120px; flex:0 0 auto;">
          <option value="title" th:selected="${pageDTO.searchKr=='글제목'}">글제목</option>
          <option value="name" th:selected="${pageDTO.searchKr=='글쓴이'}">글쓴이</option>
          <option value="content" th:selected="${pageDTO.searchKr=='글내용'}">글내용</option>
        </select>
        <input type="text" id="searchStr" name="searchStr" th:value="${pageDTO.searchStr}" required />
        <input type="submit" value="검색" class="btn btn-secondary btn-sm mb" />
      </div>
    </form>
    <!-- 검색기 끝 -->
  </div>
</html>