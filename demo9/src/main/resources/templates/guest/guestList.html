<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
                layout:decorate="~{layouts/basicLayout}">
  <th:block layout:fragment="script">
    <script th:inline="javascript">
      // 방명록 삭제처리
      function guestDelete(id) {
        let ans = confirm("삭제할까요?");
        if(ans) location.href = "/guest/guestDelete?id="+id;
      }
    </script>
  </th:block>
  <div layout:fragment="content">
    <h2 class="text-center">방명록 리스트</h2>
    <p><br/></p>
    <table class="table table-borderless m-0 p-0">
      <tr>
        <td class="text-start">
          <a th:href="@{/guest/guestInput}" class="btn btn-success btn-sm">글쓰기</a>
          <th:block th:if="${session.sName == null}"><a th:href="@{/member/memberLogin}" class="btn btn-primary btn-sm">로그인</a></th:block>
          <th:block th:if="${session.sName != null}"><a th:href="@{/member/memberLogout}" class="btn btn-warning btn-sm">로그아웃</a></th:block>
        </td>
        <td class="text-end">
          <th:block th:if="${pag-1 > 1}">
            <a th:href="@{/guest/guestList(pag=0, pageSize=${pageSize})}" class="text-decoration-none text-dark">◁</a>
            <a th:href="@{/guest/guestList(pag=${pag-2}, pageSize=${pageSize})}" class="text-decoration-none text-dark">◀</a>
          </th:block>
          [[${pag}]]/[[${totPage}]]
          <th:block th:if="${pag-1 < totPage}">
            <a th:href="@{/guest/guestList(pag=${pag-1})}" class="text-decoration-none text-dark">▶</a>
            <a th:href="@{/guest/guestList(pag=${totPage-1})}" class="text-decoration-none text-dark">▷</a>
          </th:block>
        </td>
      </tr>
    </table>
    <hr/>
    <div th:each="dto, st : ${guestList}">
      <div id="${dto.id}demo"></div>
      <table class="table table-borderless m-0 p-0">
        <tr>
          <td>번호: [[${curScrStartNo - st.index}]] &nbsp;&nbsp;
            <th:block sec:authorize="hasAnyAuthority('ROLE_ADMIN')">
              <a th:href="|javascript:guestUpdate(${dto.id})|" class="btn btn-info btn-sm">수정</a>
              <a th:href="|javascript:guestDelete(${dto.id})|" class="btn btn-danger btn-sm">삭제</a>
            </th:block>
          </td>
          <td class="text-end">방문IP: [[${dto.hostIP}]]</td>
        </tr>
      </table>
      <table class="table table-bordered">
        <tr>
          <th>방문자</th>
          <td>[[${dto.name}]]</td>
          <th>방문일자</th>
          <!--<td colspan="3" th:text="${#strings.substring(dto.visitDate,0,10)}"></td>-->
          <td colspan="3" th:text="${#strings.substring(#strings.replace(dto.visitDate,'T',' '),0,19)}"></td>
        </tr>
        <tr>
          <th>이메일</th>
          <td colspan="3" th:text="${#strings.isEmpty(dto.email)?'없음':dto.email}">
          </td>
        </tr>
        <tr>
          <th>홈페이지</th>
          <td colspan="3" th:text="${dto.homePage=='https://'?'없음':dto.homePage}">
          </td>
        </tr>
        <tr>
          <th>방문소감</th>
          <td colspan="3" style="height:150px; text-align:left" th:utext="${#strings.replace(dto.content, newLine, '&lt;br/&gt;')}"></td>
        </tr>
      </table>
      <br/>
    </div>
    <!--
    <div class="pagination justify-content-center">
      <th:block th:if="${pag-1 > 1}"><a th:href="@{/guest/guestList(pag=0)}" class="page-item page-link">첫 페이지</a></th:block>
      <th:block th:if="${curBlock > 0}"><a th:href="@{/guest/guestList(pag=${(curBlock - 1) * (blockSize + 1)}-1)}" class="page-item page-link">이전 블록</a></th:block>
      <div th:each="i: ${#numbers.sequence((curBlock * blockSize) + 1, (curBlock * blockSize) + blockSize)}">
        <th:block th:if="${i <= totPage && i == pag-1}">
          <span class="page-item active page-link">[[${i}]]</span>
        </th:block>
        <th:block th:if="${i <= totPage && i != pag-1}">
          <a th:href="@{/guest/guestList?pag=${i-1}}" class="page-item page-link">[[${i}]]</a>
        </th:block>
      </div>
      <th:block th:if="${curBlock < lastBlock}"><a th:href="@{/guest/guestList(pag=${(curBlock + 1) * (blockSize + 1)}-1)}" class="page-item page-link">다음 블록</a></th:block>
      <th:block th:if="${pag-1 < totPage}"><a th:href="@{/guest/guestList(pag=${totPage}-1)}" class="page-item page-link">마지막 페이지</a></th:block>
    </div>
    -->
    <div class="text-center">
      <ul class="pagination justify-content-center">
        <th:block th:if="${pag > 1}"><li class="page-item"><a class="page-link text-secondary" th:href="@{guestList(pageSize=${pageSize},pag=0)}">첫페이지</a></li></th:block>
        <th:block th:if="${curBlock > 0}"><li class="page-item"><a class="page-link text-secondary" th:href="@{guestList(pageSize=${pageSize},pag=${(curBlock-1)*blockSize+1-1})}">이전블록</a></li></th:block>
        <th:block th:each="i: ${#numbers.sequence((curBlock*blockSize)+1,(curBlock*blockSize)+blockSize)}">
        <th:block th:if="${i <= totPage && i == pag}"><li class="page-item active"><a class="page-link bg-secondary border-secondary" th:href="@{guestList(pageSize=${pageSize},pag=${i-1})}" th:text="${i}"></a></li></th:block>
        <th:block th:if="${i <= totPage && i != pag}"><li class="page-item"><a class="page-link text-secondary" th:href="@{guestList(pageSize=${pageSize},pag=${i-1})}" th:text="${i}"></a></li></th:block>
        </th:block>
        <th:block th:if="${curBlock < lastBlock}"><li class="page-item"><a class="page-link text-secondary" th:href="@{guestList(pageSize=${pageSize},pag=${(curBlock+1)*blockSize+1-1})}">다음블록</a></li></th:block>
        <th:block th:if="${pag < totPage}"><li class="page-item"><a class="page-link text-secondary" th:href="@{guestList(pageSize=${pageSize},pag=${totPage-1})}">마지막페이지</a></li></th:block>
      </ul>
    </div>
  </div>
</html>